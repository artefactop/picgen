# This cloud build is intended to be executed 
# with the Cloud Build Github App triggers
options:
  env:
  - GO111MODULE=on
  - GOPROXY=https://proxy.golang.org
  - CGO_ENABLED=0
  - GOOS=linux
  
steps:
# Build binaries
- name: golang:1.14
  args: ['go', 'build', '-mod=readonly', '-v', './cmd/picgen']
  id: 'go-build'

# Docker build revision tag.
- name: 'gcr.io/cloud-builders/docker'
  args: [ 'build', '-t', 'gcr.io/$PROJECT_ID/picgen:$REVISION_ID', '-f', './build/Dockerfile', '.' ]
  id: 'docker-build-revision'
  waitFor: ['go-build']

images: ['gcr.io/$PROJECT_ID/picgen:$REVISION_ID']
